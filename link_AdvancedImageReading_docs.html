

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced Image Reading &mdash; SimpleITK 1.2.0.dev documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.js"></script>
        <script type="text/javascript" src="_static/sphinx_tabs/tabs.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="IO Selection for Image Reading" href="link_ImageIOSelection_docs.html" />
    <link rel="prev" title="Image Viewing" href="link_ImageViewing_docs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SimpleITK
          

          
            
            <img src="_static/simpleitk_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentalConcepts.html">Fundamental Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="registrationOverview.html">Registration Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">Common Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="IO.html">Reading and Writing for Images and Transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters.html">SimpleITK Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building SimpleITK</a></li>
<li class="toctree-l1"><a class="reference internal" href="setUp.html">Setting Up Eclipse and Visual Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorialsAndCourses.html">Tutorials and Courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="FilterTemplates.html">Developer</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="link_examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="link_HelloWorld_docs.html">Hello World</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_CSharp_docs.html">CSharp Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_DemonsRegistration1_docs.html">DemonsRegistration1</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_DemonsRegistration2_docs.html">DemonsRegistration2</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_DicomImagePrintTags_docs.html">Read Image Meta-Data Dictionary and Print</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_DicomSeriesReader_docs.html">Dicom Series Reader</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_DicomSeriesReadModifyWrite_docs.html">Dicom Series Read Modify Write</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_DicomSeriesFromArray_docs.html">Dicom Series From Array</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_FastMarchingSegmentation_docs.html">Fast Marching Segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_FilterProgressReporting_docs.html">Filter Progress Reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_ImageGridManipulation_docs.html">Image Grid Manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_ImageRegistrationMethod1_docs.html">Image Registration Method 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_ImageRegistrationMethod2_docs.html">Image Registration Method 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_ImageRegistrationMethod3_docs.html">Image Registration Method 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_ImageRegistrationMethod4_docs.html">Image Registration Method 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_ImageRegistrationMethodBSpline1_docs.html">Image Registration Method BSpline 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_ImageRegistrationMethodBSpline2_docs.html">Image Registration Method BSpline 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_ImageRegistrationMethodBSpline3_docs.html">Image Registration Method BSpline 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_ImageRegistrationMethodDisplacement1_docs.html">Image Registration Method Displacement 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_ImageRegistrationMethodExhaustive_docs.html">Image Registration Method Exhaustive</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_ITKIntegration_docs.html">Integration with ITK</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_N4BiasFieldCorrection_docs.html">N4 Bias Field Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_SimpleGaussian_docs.html">Reading-Gaussian Blurring-Writing</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_ImageViewing_docs.html">Image Viewing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Advanced Image Reading</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#querying-an-image-for-its-meta-data">Querying an image for its meta-data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reading-an-image-sub-region">Reading an image sub-region</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#code">Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="link_ImageIOSelection_docs.html">IO Selection for Image Reading</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SimpleITK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="link_examples.html">Examples</a> &raquo;</li>
        
      <li>Advanced Image Reading</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/link_AdvancedImageReading_docs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="advanced-image-reading">
<span id="lbl-advanced-image-reading"></span><h1>Advanced Image Reading<a class="headerlink" href="#advanced-image-reading" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This example illustrates advanced image reading options:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Querying an image for its meta-data without reading the bulk intensity data.</li>
<li>Reading a sub-region of an image.</li>
</ol>
</div></blockquote>
<div class="section" id="querying-an-image-for-its-meta-data">
<h3>Querying an image for its meta-data<a class="headerlink" href="#querying-an-image-for-its-meta-data" title="Permalink to this headline">¶</a></h3>
<p>In some cases you may only want to read an image’s meta-data without reading the
bulk intensity data into memory. For instance, if you want to read subregions of
an image and not the whole image or if you want to display image
information (e.g. patient name) to a user in a GUI which then allows them to
select a specific image.</p>
</div>
<div class="section" id="reading-an-image-sub-region">
<h3>Reading an image sub-region<a class="headerlink" href="#reading-an-image-sub-region" title="Permalink to this headline">¶</a></h3>
<p>In some cases you are only interested in reading a sub-region of an image. This
may be due to memory constraints or if it is known that the relevant content is
always in a sub region of the image. If the specific image IO used for this operation
supports streaming then this will indeed only read the sub-region, otherwise the whole
image is read into memory and the sub-region is returned. The IOs that support
streaming are:
1. TIFFImageIO (supports a subset of encodings)
2. MetaImageIO
3. NrrdImageIO
4. HDF5ImageIO (supports a subset of encodings)
5. MRCImageIO
6. VTKImageIO (supports a subset of encodings)</p>
</div>
</div>
<div class="section" id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-0-0 docutils container">
<div class="docutils container">
Python</div>
</div>
<div class="item sphinx-data-tab-0-1 docutils container">
<div class="docutils container">
R</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-0 active docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">SimpleITK</span> <span class="kn">as</span> <span class="nn">sitk</span>


<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Wrong number of arguments.&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Usage: &#39;</span> <span class="o">+</span> <span class="vm">__file__</span> <span class="o">+</span> <span class="s1">&#39; image_file_name&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Read image information without reading the bulk data.</span>
<span class="n">file_reader</span> <span class="o">=</span> <span class="n">sitk</span><span class="o">.</span><span class="n">ImageFileReader</span><span class="p">()</span>
<span class="n">file_reader</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">file_reader</span><span class="o">.</span><span class="n">ReadImageInformation</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;image size: {0}</span><span class="se">\n</span><span class="s1">image spacing: {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_reader</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(),</span> <span class="n">file_reader</span><span class="o">.</span><span class="n">GetSpacing</span><span class="p">()))</span>
<span class="c1"># Some files have a rich meta-data dictionary (e.g. DICOM)</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file_reader</span><span class="o">.</span><span class="n">GetMetaDataKeys</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">file_reader</span><span class="o">.</span><span class="n">GetMetaData</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># When low on memory, we can incrementally work on sub-images. The following</span>
<span class="c1"># subtracts two images (ok, the same image) by reading them as multiple sub-images.</span>

<span class="n">image1_file_name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">image2_file_name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">parts</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># Number of sub-regions we use</span>

<span class="n">file_reader</span> <span class="o">=</span> <span class="n">sitk</span><span class="o">.</span><span class="n">ImageFileReader</span><span class="p">()</span>
<span class="n">file_reader</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">image1_file_name</span><span class="p">)</span>
<span class="n">file_reader</span><span class="o">.</span><span class="n">ReadImageInformation</span><span class="p">()</span>
<span class="n">image_size</span> <span class="o">=</span> <span class="n">file_reader</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>

<span class="n">result_img</span> <span class="o">=</span> <span class="n">sitk</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">file_reader</span><span class="o">.</span><span class="n">GetSize</span><span class="p">(),</span> <span class="n">file_reader</span><span class="o">.</span><span class="n">GetPixelID</span><span class="p">(),</span> <span class="n">file_reader</span><span class="o">.</span><span class="n">GetNumberOfComponents</span><span class="p">())</span>
<span class="n">result_img</span><span class="o">.</span><span class="n">SetSpacing</span><span class="p">(</span><span class="n">file_reader</span><span class="o">.</span><span class="n">GetSpacing</span><span class="p">())</span>
<span class="n">result_img</span><span class="o">.</span><span class="n">SetOrigin</span><span class="p">(</span><span class="n">file_reader</span><span class="o">.</span><span class="n">GetOrigin</span><span class="p">())</span>
<span class="n">result_img</span><span class="o">.</span><span class="n">SetDirection</span><span class="p">(</span><span class="n">file_reader</span><span class="o">.</span><span class="n">GetDirection</span><span class="p">())</span>

<span class="n">extract_size</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">file_reader</span><span class="o">.</span><span class="n">GetSize</span><span class="p">())</span>
<span class="n">extract_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">extract_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="n">parts</span>
<span class="n">current_index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">file_reader</span><span class="o">.</span><span class="n">GetDimension</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parts</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="p">(</span><span class="n">parts</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">extract_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">file_reader</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">image1_file_name</span><span class="p">)</span>
    <span class="n">file_reader</span><span class="o">.</span><span class="n">SetExtractIndex</span><span class="p">(</span><span class="n">current_index</span><span class="p">)</span>
    <span class="n">file_reader</span><span class="o">.</span><span class="n">SetExtractSize</span><span class="p">(</span><span class="n">extract_size</span><span class="p">)</span>
    <span class="n">sub_image1</span> <span class="o">=</span> <span class="n">file_reader</span><span class="o">.</span><span class="n">Execute</span><span class="p">()</span>

    <span class="n">file_reader</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">image2_file_name</span><span class="p">)</span>
    <span class="n">file_reader</span><span class="o">.</span><span class="n">SetExtractIndex</span><span class="p">(</span><span class="n">current_index</span><span class="p">)</span>
    <span class="n">file_reader</span><span class="o">.</span><span class="n">SetExtractSize</span><span class="p">(</span><span class="n">extract_size</span><span class="p">)</span>
    <span class="n">sub_image2</span> <span class="o">=</span> <span class="n">file_reader</span><span class="o">.</span><span class="n">Execute</span><span class="p">()</span>
    <span class="n">result_img</span> <span class="o">=</span> <span class="n">sitk</span><span class="o">.</span><span class="n">Paste</span><span class="p">(</span><span class="n">result_img</span><span class="p">,</span> <span class="n">sub_image1</span> <span class="o">-</span> <span class="n">sub_image2</span><span class="p">,</span> <span class="n">extract_size</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">file_reader</span><span class="o">.</span><span class="n">GetDimension</span><span class="p">(),</span> <span class="n">current_index</span><span class="p">)</span>
    <span class="n">current_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">extract_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">del</span> <span class="n">sub_image1</span>
<span class="k">del</span> <span class="n">sub_image2</span>

<span class="c1"># Check that our iterative approach is equivalent to reading the whole images.</span>
<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">sitk</span><span class="o">.</span><span class="n">GetArrayViewFromImage</span><span class="p">(</span><span class="n">result_img</span> <span class="o">-</span> <span class="n">sitk</span><span class="o">.</span><span class="n">ReadImage</span><span class="p">(</span><span class="n">image1_file_name</span><span class="p">)</span> <span class="o">+</span> <span class="n">sitk</span><span class="o">.</span><span class="n">ReadImage</span><span class="p">(</span><span class="n">image2_file_name</span><span class="p">))):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Subtraction error.&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-1 docutils container">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">SimpleITK</span><span class="p">)</span>

<span class="n">args</span> <span class="o">&lt;-</span> <span class="nf">commandArgs</span><span class="p">(</span> <span class="kc">TRUE</span> <span class="p">)</span>

<span class="nf">if </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
   <span class="nf">write</span><span class="p">(</span><span class="s">&#39;Usage arguments: &lt;image_file_name&gt;&#39;</span><span class="p">,</span> <span class="nf">stderr</span><span class="p">())</span>
   <span class="nf">quit</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="s">&quot;no&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Read image information without reading the bulk data.</span>
<span class="n">file_reader</span> <span class="o">&lt;-</span> <span class="nf">ImageFileReader</span><span class="p">()</span>
<span class="n">file_reader</span><span class="o">$</span><span class="nf">SetFileName</span><span class="p">(</span><span class="n">args[1]</span><span class="p">)</span>
<span class="n">file_reader</span><span class="o">$</span><span class="nf">ReadImageInformation</span><span class="p">()</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&#39;image size:&#39;</span><span class="p">,</span> <span class="n">file_reader</span><span class="o">$</span><span class="nf">GetSize</span><span class="p">(),</span> <span class="s">&#39;\n&#39;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&#39;image spacing:&#39;</span><span class="p">,</span> <span class="n">file_reader</span><span class="o">$</span><span class="nf">GetSpacing</span><span class="p">(),</span> <span class="s">&#39;\n&#39;</span><span class="p">)</span>
<span class="c1"># Some files have a rich meta-data dictionary (e.g. DICOM)</span>
<span class="nf">for</span><span class="p">(</span><span class="n">key</span> <span class="n">in</span> <span class="n">file_reader</span><span class="o">$</span><span class="nf">GetMetaDataKeys</span><span class="p">())</span>
<span class="p">{</span>
  <span class="nf">cat</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&#39;: &#39;</span><span class="p">,</span> <span class="n">file_reader</span><span class="o">$</span><span class="nf">GetMetaData</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="s">&#39;\n&#39;</span><span class="p">))</span>
<span class="p">}</span>
<span class="nf">cat</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="m">20</span><span class="p">),</span><span class="s">&#39;\n&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>

<span class="c1"># When low on memory, we can incrementally work on sub-images. The following</span>
<span class="c1"># subtracts two images (ok, the same image) by reading them as multiple sub-images.</span>

<span class="n">image1_file_name</span> <span class="o">&lt;-</span> <span class="n">args[1]</span>
<span class="n">image2_file_name</span> <span class="o">&lt;-</span> <span class="n">args[1]</span>

<span class="n">parts</span> <span class="o">&lt;-</span> <span class="m">5</span> <span class="c1"># Number of sub-regions we use</span>

<span class="n">file_reader</span> <span class="o">&lt;-</span> <span class="nf">ImageFileReader</span><span class="p">()</span>
<span class="n">file_reader</span><span class="o">$</span><span class="nf">SetFileName</span><span class="p">(</span><span class="n">image1_file_name</span><span class="p">)</span>
<span class="n">file_reader</span><span class="o">$</span><span class="nf">ReadImageInformation</span><span class="p">()</span>
<span class="n">image_size</span> <span class="o">&lt;-</span> <span class="n">file_reader</span><span class="o">$</span><span class="nf">GetSize</span><span class="p">()</span>

<span class="n">result_img</span> <span class="o">&lt;-</span> <span class="nf">Image</span><span class="p">(</span><span class="n">file_reader</span><span class="o">$</span><span class="nf">GetSize</span><span class="p">(),</span> <span class="n">file_reader</span><span class="o">$</span><span class="nf">GetPixelID</span><span class="p">(),</span> <span class="n">file_reader</span><span class="o">$</span><span class="nf">GetNumberOfComponents</span><span class="p">())</span>
<span class="n">result_img</span><span class="o">$</span><span class="nf">SetSpacing</span><span class="p">(</span><span class="n">file_reader</span><span class="o">$</span><span class="nf">GetSpacing</span><span class="p">())</span>
<span class="n">result_img</span><span class="o">$</span><span class="nf">SetOrigin</span><span class="p">(</span><span class="n">file_reader</span><span class="o">$</span><span class="nf">GetOrigin</span><span class="p">())</span>
<span class="n">result_img</span><span class="o">$</span><span class="nf">SetDirection</span><span class="p">(</span><span class="n">file_reader</span><span class="o">$</span><span class="nf">GetDirection</span><span class="p">())</span>

<span class="n">extract_size</span> <span class="o">&lt;-</span> <span class="n">file_reader</span><span class="o">$</span><span class="nf">GetSize</span><span class="p">()</span>
<span class="n">extract_size[</span><span class="m">-1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">extract_size[</span><span class="m">-1</span><span class="n">]</span><span class="o">%/%</span><span class="n">parts</span>
<span class="n">current_index</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">file_reader</span><span class="o">$</span><span class="nf">GetDimension</span><span class="p">())</span>
<span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="n">parts</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nf">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">parts</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">extract_size[</span><span class="m">-1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">image_size[</span><span class="m">-1</span><span class="n">]</span> <span class="o">-</span> <span class="n">current_index[</span><span class="m">-1</span><span class="n">]</span>
  <span class="p">}</span>
  <span class="n">file_reader</span><span class="o">$</span><span class="nf">SetFileName</span><span class="p">(</span><span class="n">image1_file_name</span><span class="p">)</span>
  <span class="n">file_reader</span><span class="o">$</span><span class="nf">SetExtractIndex</span><span class="p">(</span><span class="n">current_index</span><span class="p">)</span>
  <span class="n">file_reader</span><span class="o">$</span><span class="nf">SetExtractSize</span><span class="p">(</span><span class="n">extract_size</span><span class="p">)</span>
  <span class="n">sub_image1</span> <span class="o">&lt;-</span> <span class="n">file_reader</span><span class="o">$</span><span class="nf">Execute</span><span class="p">()</span>

  <span class="n">file_reader</span><span class="o">$</span><span class="nf">SetFileName</span><span class="p">(</span><span class="n">image2_file_name</span><span class="p">)</span>
  <span class="n">file_reader</span><span class="o">$</span><span class="nf">SetExtractIndex</span><span class="p">(</span><span class="n">current_index</span><span class="p">)</span>
  <span class="n">file_reader</span><span class="o">$</span><span class="nf">SetExtractSize</span><span class="p">(</span><span class="n">extract_size</span><span class="p">)</span>
  <span class="n">sub_image2</span> <span class="o">&lt;-</span> <span class="n">file_reader</span><span class="o">$</span><span class="nf">Execute</span><span class="p">()</span>
  <span class="n">result_img</span> <span class="o">&lt;-</span> <span class="nf">Paste</span><span class="p">(</span><span class="n">result_img</span><span class="p">,</span> <span class="n">sub_image1</span> <span class="o">-</span> <span class="n">sub_image2</span><span class="p">,</span> <span class="n">extract_size</span><span class="p">,</span> <span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">file_reader</span><span class="o">$</span><span class="nf">GetDimension</span><span class="p">()),</span> <span class="n">current_index</span><span class="p">)</span>
  <span class="n">current_index[</span><span class="m">-1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">current_index[</span><span class="m">-1</span><span class="n">]</span> <span class="o">+</span> <span class="n">extract_size[</span><span class="m">-1</span><span class="n">]</span>
<span class="p">}</span>

<span class="nf">rm</span><span class="p">(</span><span class="n">sub_image1</span><span class="p">,</span> <span class="n">sub_image2</span><span class="p">)</span>

<span class="c1"># Check that our iterative approach is equivalent to reading the whole images.</span>
<span class="nf">if</span><span class="p">(</span><span class="nf">any</span><span class="p">(</span><span class="nf">as.array</span><span class="p">(</span><span class="n">result_img</span> <span class="o">-</span> <span class="nf">ReadImage</span><span class="p">(</span><span class="n">image1_file_name</span><span class="p">)</span> <span class="o">+</span> <span class="nf">ReadImage</span><span class="p">(</span><span class="n">image2_file_name</span><span class="p">))</span><span class="o">!=</span><span class="m">0</span><span class="p">))</span>
<span class="p">{</span>
  <span class="nf">cat</span><span class="p">(</span><span class="s">&#39;Subtraction error.\n&#39;</span><span class="p">)</span>
  <span class="nf">quit</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="s">&quot;no&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="p">}</span>
<span class="nf">quit</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="s">&quot;no&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="link_ImageIOSelection_docs.html" class="btn btn-neutral float-right" title="IO Selection for Image Reading" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="link_ImageViewing_docs.html" class="btn btn-neutral float-left" title="Image Viewing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Insight Software Consortium

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>