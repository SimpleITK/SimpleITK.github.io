

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Registration Overview &mdash; SimpleITK 1.2.0.dev documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Common Conventions" href="conventions.html" />
    <link rel="prev" title="Fundamental Concepts" href="fundamentalConcepts.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SimpleITK
          

          
            
            <img src="_static/simpleitk_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentalConcepts.html">Fundamental Concepts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Registration Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#actual-code">Actual Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">ImageRegistrationMethod</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#transform">Transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="#similarity-metric">Similarity Metric</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optimizer">Optimizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interpolator">Interpolator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features-of-interest">Features of Interest</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#transforms-and-image-spaces">Transforms and image spaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multi-resolution-framework">Multi Resolution Framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sampling">Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scaling-in-parameter-space">Scaling in Parameter Space</a></li>
<li class="toctree-l4"><a class="reference internal" href="#observing-registration-progress">Observing Registration Progress</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">Common Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="IO.html">Reading and Writing for Images and Transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters.html">SimpleITK Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building SimpleITK</a></li>
<li class="toctree-l1"><a class="reference internal" href="setUp.html">Setting Up Eclipse and Visual Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorialsAndCourses.html">Tutorials and Courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="FilterTemplates.html">Developer</a></li>
<li class="toctree-l1"><a class="reference internal" href="link_examples.html">Examples</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SimpleITK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Registration Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/registrationOverview.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="registration-overview">
<span id="lbl-registration-overview"></span><h1>Registration Overview<a class="headerlink" href="#registration-overview" title="Permalink to this headline">¶</a></h1>
<p>The goal of registration is to estimate the transformation which maps points
from one image to the corresponding points in another image. The
transformation estimated via registration is said to map points from the
<strong>fixed image</strong> coordinate system to the <strong>moving image</strong> coordinate system.</p>
<p>SimpleITK provides a configurable multi-resolution registration
framework, implemented in the <a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ImageRegistrationMethod.html">ImageRegistrationMethod</a> class.
In addition, a number of variations of the Demons registration algorithm are
implemented independently from this class as they do not fit into the framework.</p>
<div class="section" id="actual-code">
<h2>Actual Code<a class="headerlink" href="#actual-code" title="Permalink to this headline">¶</a></h2>
<p>Code illustrating various aspects of the registration framework can be found in
the set of <a class="reference internal" href="link_examples.html#lbl-examples"><span class="std std-ref">examples</span></a> which are part of the SimpleITK distribution
and in the SimpleITK <a class="reference external" href="http://insightsoftwareconsortium.github.io/SimpleITK-Notebooks/">Jupyter notebook repository</a>.</p>
</div>
<div class="section" id="id1">
<h2>ImageRegistrationMethod<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>To create a specific registration instance using the ImageRegistrationMethod
you need to select several components which together define the registration instance:</p>
<ol class="arabic simple">
<li>Transformation.</li>
<li>Similarity metric.</li>
<li>Optimizer.</li>
<li>Interpolator.</li>
</ol>
<div class="section" id="transform">
<h3>Transform<a class="headerlink" href="#transform" title="Permalink to this headline">¶</a></h3>
<p>The type of transformation defines the mapping between the two images. SimpleITK
supports a variety of global and local transformations. The available
transformations include:</p>
<ul class="simple">
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1TranslationTransform.html">TranslationTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1VersorTransform.html">VersorTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1VersorRigid3DTransform.html">VersorRigid3DTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1Euler2DTransform.html">Euler2DTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1Euler3DTransform.html">Euler3DTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1Similarity2DTransform.html">Similarity2DTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1Similarity3DTransform.html">Similarity3DTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ScaleTransform.html">ScaleTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ScaleVersor3DTransform.html">ScaleVersor3DTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ScaleSkewVersor3DTransform.html">ScaleSkewVersor3DTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1AffineTransform.html">AffineTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1BSplineTransform.html">BSplineTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1DisplacementFieldTransform.html">DisplacementFieldTransform</a>.</li>
<li><a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1Transform.html">Composite Transform</a>.</li>
</ul>
<p>The parameters modified by the registration framework are those returned by the
transforms <strong>GetParameters()</strong> method. This requires special attention when the
using a composite transform, as the specific parameters vary
based on the content of your composite transformation.</p>
</div>
<div class="section" id="similarity-metric">
<h3>Similarity Metric<a class="headerlink" href="#similarity-metric" title="Permalink to this headline">¶</a></h3>
<p>The similarity metric reflects the relationship between the intensities of the
images (identity, affine, stochastic…). The available metrics include:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1MeanSquaresImageToImageMetricv4.html">MeanSquares</a> .</li>
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1DemonsImageToImageMetricv4.html">Demons</a>.</li>
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1CorrelationImageToImageMetricv4.html">Correlation</a>.</li>
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1ANTSNeighborhoodCorrelationImageToImageMetricv4.html">ANTSNeighborhoodCorrelation</a>.</li>
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1JointHistogramMutualInformationImageToImageMetricv4.html">JointHistogramMutualInformation</a>.</li>
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1MattesMutualInformationImageToImageMetricv4.html">MattesMutualInformation</a>.</li>
</ul>
<p>In the ITKv4 and consequentially in SimpleITK all similarity metrics are
minimized. For metrics whose optimum corresponds to a maximum, such as mutual
information, the metric value is negated internally. The selection of a
similarity metric is done using the ImageRegistrationMethod’s <strong>SetMetricAsX()</strong>
methods.</p>
</div>
<div class="section" id="optimizer">
<h3>Optimizer<a class="headerlink" href="#optimizer" title="Permalink to this headline">¶</a></h3>
<p>The optimizer is selected using the <strong>SetOptimizerAsX()</strong> methods.
When selecting the optimizer you will also need to configure it (e.g. set the
number of iterations). The available optimizers include:</p>
<ul class="simple">
<li>Gradient free<ul>
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1ExhaustiveOptimizerv4.html">Exhaustive</a>.</li>
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1AmoebaOptimizerv4.html">Nelder-Mead downhill simplex</a> (Amoeba).</li>
<li><a class="reference external" href="https://itk.org/Doxygen/html/classitk_1_1PowellOptimizerv4.html">Powell</a>.</li>
<li><a class="reference external" href="https://itk.org/Doxygen/html/classitk_1_1OnePlusOneEvolutionaryOptimizerv4.html">1+1 evolutionary optimizer</a>.</li>
</ul>
</li>
<li>Gradient based:<ul>
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1GradientDescentOptimizerv4Template.html">Gradient Descent</a>.</li>
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1GradientDescentLineSearchOptimizerv4Template.html">Gradient Descent Line Search</a>.</li>
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1RegularStepGradientDescentOptimizerv4.html">Regular Step Gradient Descent</a>.</li>
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1ConjugateGradientLineSearchOptimizerv4Template.html">Conjugate Gradient Line Search</a>.</li>
<li><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1LBFGSBOptimizerv4.html">L-BFGS-B</a>. Limited memory Broyden, Fletcher, Goldfarb, Shannon, Bound Constrained (supports the use of simple constraints).</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="interpolator">
<h3>Interpolator<a class="headerlink" href="#interpolator" title="Permalink to this headline">¶</a></h3>
<p>SimpleITK has a large number of interpolators. In most cases linear
interpolation, the default setting, is sufficient. Unlike the similarity metric
and optimizer, the interpolator is set using the <strong>SetInterpolator</strong> method which
receives a <a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/namespaceitk_1_1simple.html#a7cb1ef8bd02c669c02ea2f9f5aa374e5">parameter</a>
indicating the interpolator type.</p>
</div>
<div class="section" id="features-of-interest">
<h3>Features of Interest<a class="headerlink" href="#features-of-interest" title="Permalink to this headline">¶</a></h3>
<div class="section" id="transforms-and-image-spaces">
<h4>Transforms and image spaces<a class="headerlink" href="#transforms-and-image-spaces" title="Permalink to this headline">¶</a></h4>
<p>While the goal of registration, as defined above, refers to a single
transformation and two images, the ITKv4 registration and the
SimpleITK ImageRegistrationMethod provide additional flexibility in
registration configuration.</p>
<p>From a coordinate system standpoint ITKv4 introduced the
<strong>virtual image domain</strong>, making registration a symmetric process so that both
images are treated similarly. As a consequence the ImageRegistrationMethod
has methods for setting <strong>three transformations</strong>:</p>
<p>1. SetInitialTransform <span class="math notranslate nohighlight">\(T_o\)</span> - composed with the moving initial transform, maps
points from the virtual image domain to the moving image domain, modified
during optimization.</p>
<p>2. SetFixedInitialTransform <span class="math notranslate nohighlight">\(T_f\)</span> - maps points from the virtual image domain
to the fixed image domain, never modified.</p>
<p>3. SetMovingInitialTransform <span class="math notranslate nohighlight">\(T_m\)</span>- maps points from the virtual image domain to
the moving image domain, never modified.</p>
<p>The transformation that maps points from the fixed to moving image domains is thus:</p>
<div class="math notranslate nohighlight">
\[p_{moving}=T_o(T_m(T_f^{-1}(p_{fixed})))\]</div>
</div>
<div class="section" id="multi-resolution-framework">
<h4>Multi Resolution Framework<a class="headerlink" href="#multi-resolution-framework" title="Permalink to this headline">¶</a></h4>
<p>The ImageRegistrationMethod supports multi-resolution, pyramid, registration
via two methods <a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a59fef92122919202cf4a00f84fd87ea5">SetShrinkFactorsPerLevel</a>
and <a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a0aea868182491c8d6900129955b4f5b4">SetSmoothingSigmasPerLevel</a>.
The former receives the shrink factors to apply when moving from one level of
the pyramid to the next and the later receives the sigmas to use for smoothing
when moving from level to level. Sigmas can be specified either in voxel units
or physical units (default) using <a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a50c2a2242421fdcafdc42d548b994ed9">SetSmoothingSigmasAreSpecifiedInPhysicalUnits</a>.</p>
</div>
<div class="section" id="sampling">
<h4>Sampling<a class="headerlink" href="#sampling" title="Permalink to this headline">¶</a></h4>
<p>For many registration tasks one can use a fraction of the image voxels to
estimate the similarity measure. Aggressive sampling can significantly reduce
the registration runtime. The ImageRegistration method allows you to
specify how/if to sample the voxels, <a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#aa49fdfae5950c2ec6e01a75df59078f6">SetMetricSamplingStrategy</a>, and
if using a sampling, what percentage, <a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a8b891c62404a8dc5010241fea619c932">SetMetricSamplingPercentage</a>.</p>
</div>
<div class="section" id="scaling-in-parameter-space">
<h4>Scaling in Parameter Space<a class="headerlink" href="#scaling-in-parameter-space" title="Permalink to this headline">¶</a></h4>
<p>The ITKv4 framework introduced automated methods for estimating scaling factors
for non-commensurate parameter units. These change the step size per parameter
so that the effect of a unit of change has similar effects in physical space
(think rotation of 1 radian and translation of 1 millimeter).
The relevant methods are <a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a53934282121e152d37781ffa5224ec5f">SetOptimizerScalesFromPhysicalShift</a>,
<a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a0ad235e8291716cb44c87a01c6b545a9">SetOptimizerScalesFromIndexShift</a> and
<a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#afe20311a9a425f312e3cefaaf683fab4">SetOptimizerScalesFromJacobian</a>.
In many cases this scaling is what determines if the the optimization converges to the
correct optimum.</p>
</div>
<div class="section" id="observing-registration-progress">
<h4>Observing Registration Progress<a class="headerlink" href="#observing-registration-progress" title="Permalink to this headline">¶</a></h4>
<p>The ImageRegistrationMethod enables you to observe the registration process as it progresses.
This is done using the Command-Observer pattern, associating callbacks with specific events.
To associate a callback with a specific <a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/namespaceitk_1_1simple.html#aa7399868984d99493c5a307cce373ace">event</a>
use the <a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/classitk_1_1simple_1_1ProcessObject.html#a2199e5cca19b45d504676a595e1f6cfd">AddCommand</a>
method.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="conventions.html" class="btn btn-neutral float-right" title="Common Conventions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="fundamentalConcepts.html" class="btn btn-neutral float-left" title="Fundamental Concepts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Insight Software Consortium

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>