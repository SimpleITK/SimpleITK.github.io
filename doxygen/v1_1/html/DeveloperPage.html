<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>SimpleITK: SimpleITK Developer Notes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SimpleITK
   &#160;<span id="projectnumber">1.2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SimpleITK Developer Notes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Procedures"></a>
Procedures</h1>
<h2><a class="anchor" id="Contributions"></a>
User Contributions</h2>
<p>Users can contribute patches through the gerrit code review system: <a href="http://review.source.kitware.com/#q,SimpleITK,n,z">http://review.source.kitware.com/#q,SimpleITK,n,z</a></p>
<p>General information about Gerrit can be found here: <a href="http://gerrit.googlecode.com/svn/documentation/2.2.1/user-upload.html">http://gerrit.googlecode.com/svn/documentation/2.2.1/user-upload.html</a></p>
<p>For those already familiar with git, gerrit, ITK and building SimpelITK, here is a quick overview of the process:</p>
<p>The first thing which should be done before any code is committed locally is running the script to setup your local git repository for development.</p>
<div class="fragment"><div class="line">$ Utilities/SetupForDevelopment.sh</div>
</div><!-- fragment --><p>This will guide you through the processes of adding several repositories and local configuration options.</p>
<p>The following is an overview of how to add commits locally, and push the changes to gerrit:</p>
<div class="fragment"><div class="line">$ git checkout master</div>
<div class="line">$ git pull</div>
<div class="line">$ git checkout -b $MyTopic$</div>
<div class="line">hack and edit</div>
<div class="line">compile and <a class="codeRef" doxygen="/work/SimpleITK-build/SimpleITK-build/Documentation/Doxygen/InsightDoxygen.tag:https://www.itk.org/Doxygen/html//" href="https://www.itk.org/Doxygen/html/itkMeshFileTestHelper_8h.html#a0860ef1b760ad2db16c8fc1d26120215">test</a></div>
<div class="line">$ git add $MyHackedFiles$</div>
<div class="line">$ git commit</div>
<div class="line">$ git prepush</div>
<div class="line">$ git gerrit-push</div>
</div><!-- fragment --><p>The goal of this workflow here is just have one or two commits in the topic, so that it will be easy to review. If longer topics are needed, that is OK to, but please try to reach out to the SimpleITK development community first. Please upload any new testing data as described below.</p>
<p>If you are not too familiar with these tools, this aspect of submitting patch to gerrit is the same as for ITK development. So the overview of ITK development process may be a better starting point: <a href="https://www.itk.org/Wiki/ITK/Git/Develop">https://www.itk.org/Wiki/ITK/Git/Develop</a></p>
<h2><a class="anchor" id="Add"></a>
Binary Data to a Commit</h2>
<p>Since every local Git repository contains a copy of the entire project history, it is important to avoid adding large binary files directly to the repository. Large binary files added and removed through the history of a project will cause the repository to become bloated, take up too much disk space, require excessive time and bandwidth to download, etc.</p>
<p>The solution to this problem adopted by this project is to store binary files, such as images, in a separate location outside the repository, then download the files at build time with CMake.</p>
<p>A <em>content link</em> file containing an identifying MD5 checksum is stored in the Git repository at the path where the file would exist with the <em>.md5</em> extension added to the file. CMake will find these content link files at build time, download them from a list of server resources, and create symlinks or copies of the original files at the corresponding location in the build tree.</p>
<p>The <a href="http://midas3.kitware.com/midas/">Midas server</a> is an ITK community resource where any community member can upload binary data files. This script automates the upload of data to the server and generation of the content link file. Before using this script, please go to the Midas website, register, and join the ITK community.</p>
<p>This script requires the Python module <a href="https://github.com/midasplatform/pydas">pydas</a>: which can be installed with:</p>
<div class="fragment"><div class="line">$ pip install pydas</div>
</div><!-- fragment --><p>Please use the content link system for all new test images and other binary data. An example:</p>
<div class="fragment"><div class="line">cd ~/src/SimpleITK</div>
<div class="line">cp /path/to/NewInput.png ./Testing/Input/</div>
<div class="line">python ./Utilities/UploadBinaryData.py ./Testing/Input/NewInput.png</div>
<div class="line">git add -- ./Testing/Input/NewInput.png.md5</div>
</div><!-- fragment --><h2><a class="anchor" id="Dashboards"></a>
Setup a Dashboard</h2>
<p>The SimpleITK Dashboard is a central location where systems report on continuous or nightly compilation and testing results. It is a invaluable tool in the extreme programming or agile development process. The <a href="http://www.cdash.org/CDash/index.php?project=simpleITK">SimpleITK dashboard</a> is now a standalone dashboard.</p>
<p>The following is a brief overview on how to contribute a nightly build to SimpleITK. Additional relevant information can be found on the <a href="http://www.cmake.org/cmake/help/ctest-2-8-docs.html">CTest</a> documentation page along with simular information on how to setup a dashboard for <a href="http://www.vtk.org/Wiki/ITK_Policy_and_Procedure_for_Adding_Dashboards">ITK</a>.</p>
<p>SimpleITK uses CTest to run the nightly dashboards. There are 3 things which are needed to setup a nightly dashboard. The first is the common CTest scripts. Second, is a custom script to configure SimpleITK for your system, and third is the configuration of a system tool to run the CTest script each night.</p>
<ul>
<li>The common script(s) are contained in the dashboards branch. Essentially, this branch contains the "simpleitk_common.cmake" file which will be included in the next step. It can be retrieved as follows: <div class="fragment"><div class="line">$ mkdir -p ~/Dashboards/SimpleITKScripts</div>
<div class="line">$ cd ~/Dashboards/SimpleITKScripts</div>
<div class="line">$ git init</div>
<div class="line">$ git remote add -t dashboard origin git:<span class="comment">//itk.org/SimpleITK.git</span></div>
<div class="line">$ git pull origin</div>
</div><!-- fragment --></li>
<li>Next, we need to create a custom CTest script for our system. More information on the variable are describe in the header of "simpleitk_common.cmake". Here is a sample which can be place in "~/Dashboards/SimpleITKScripts/simpleitk_nightly.cmake": <div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"># Maintainer: blowekamp@mail.nih.gov</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Set names</span></div>
<div class="line">set( CTEST_SITE <span class="stringliteral">&quot;mini5.nlm&quot;</span> )</div>
<div class="line">set( CTEST_BUILD_NAME &quot;MacOSX-SimpleITK-super-next&quot; )</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#  Set how and where to build</span></div>
<div class="line">set( CTEST_BUILD_CONFIGURATION <span class="stringliteral">&quot;Release&quot;</span> )</div>
<div class="line">set( CTEST_CMAKE_GENERATOR &quot;Unix Makefiles&quot; )</div>
<div class="line">set ( CTEST_DASHBOARD_ROOT &quot;$ENV{PLAYPEN}/${CTEST_BUILD_NAME}<span class="stringliteral">&quot; )</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">set( dashboard_model Nightly )</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">set ( dashboard_git_branch &quot;</span>next<span class="stringliteral">&quot; )</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"># Enable usage of multi-processors</span></div>
<div class="line"><span class="stringliteral">set ( CTEST_BUILD_FLAGS -j2 )</span></div>
<div class="line"><span class="stringliteral">set ( CTEST_TEST_ARGS PARALLEL_LEVEL 2 )</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"># Set initial values for the CMakeCache</span></div>
<div class="line"><span class="stringliteral">set ( dashboard_cache &quot;</span></div>
<div class="line">CMAKE_CXX_COMPILER:STRING=$ENV{HOME}/local/bin/ccache-c++</div>
<div class="line">CMAKE_CXX_FLAGS:STRING=-Wall</div>
<div class="line">CMAKE_C_COMPILER:STRING=$ENV{HOME}/local/bin/ccache-cc</div>
<div class="line">CMAKE_C_FLAGS:STRING=-Wall</div>
<div class="line"><span class="stringliteral">&quot;)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"># Include common ctest script</span></div>
<div class="line"><span class="stringliteral">include(${CTEST_SCRIPT_DIRECTORY}/simpleitk_common.cmake)</span></div>
</div><!-- fragment --></li>
<li>Lastly, the following needs to be executed each night: <div class="fragment"><div class="line">$ ctest -S ~/Dashboards/SimpleITKScripts/simpleitk_nightly.cmake</div>
</div><!-- fragment --></li>
</ul>
<p>Depending on your system the tool needed is different. For Unix and Mac OSX operating system it's the cron daemon, while on windows it is Schedualer. More information can be found on the general <a href="http://www.vtk.org/Wiki/CMake_Scripting_Of_CTest#Setting_Up_Cron.2FScheduler">CMake Scripting Of CTest</a> wiki page.</p>
<h1><a class="anchor" id="TandT"></a>
Tips and Tricks</h1>
<h2><a class="anchor" id="JSONTips"></a>
Working with JSON file.</h2>
<p>SimpleITK uses a large number of JSON files as input for generated code. Adding support for your text editor to understand the syntax is advantageous.</p>
<p>-Emacs</p>
<p>The following can be added to your ".emacs" file.</p>
<pre class="fragment">; Add JSON files to automode list, use javascript mode
(add-to-list 'auto-mode-alist '("\\.json\\'" . js-mode) )
(add-hook 'js-mode-hook (function (lambda ()
  (setq tab-width 2
        c-basic-offset 2
        show-trailing-whitespace 1) ) ) )
</pre><h2><a class="anchor" id="CCacheTips"></a>
Using ccache to accelerate re-compilation.</h2>
<p>SimpleITK has a complicated set of dependency that is handled the best it can be with CMake and the code generation tools implemented. However, when switching between branches and making changes to certain files, such as the "Expand" templates a large number of files will have to be re-compiled. Even though the generated code may not have changed, it's impossible for CMake or your make-file tool to determine this.</p>
<p>Fortunately, there is a tool which can cache results of compilation and reduce recompilation. Using <a href="http://ccache.samba.org/">ccache</a> can greatly accelerate the development time when rebuilding SimpleITK frequently. Usage is quite simple, download and install. However, getting CMake to work with the compiler requires setting a few environmental variables:</p>
<pre class="fragment">CXX=/usr/local/bin/ccache /usr/bin/g++-4.2
CC=/usr/local/bin/ccache /usr/bin/gcc-4.2
</pre><p>These variables need to be set bfore CMake is run, so that it will correctly detect the compiler and configure SimpleITK. Now enjoy the faster re-compilation times. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 16 2020 20:53:02 for SimpleITK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
