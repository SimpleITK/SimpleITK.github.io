<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>SimpleITK: Image Filter Templates ReadMe</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SimpleITK
   &#160;<span id="projectnumber">1.2.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="classitk_1_1simple_1_1Image.html" title="The Image class for SimpleITK. ">Image</a> Filter Templates ReadMe </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This ReadMe outlines the system used to generate SimpleITK files using json data files in conjunction with the template .h and .cxx files</p>
<h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p>In order to create a uniform body of image filters, we use an automated code generation system to wrap existing ITK filters into SimpleITK filters. The development process consists of writing a JSON data file which specifies the information needed to fill in the fields of the template file. During compilation, all of the .json files are parsed using a lua template engine which fills in the appropriate template file from the provided fields. This ReadMe provides a detailed description of the fields that can be used in the json data files and what effect each field has on the resulting image filter. When writing your own json file, it should be saved in:</p>
<p>$SimpleITK_SOURCE_DIR/Code/$FILTER_DIR/json</p>
<p>Here $FILTER_DIR is the directory in which the code for the generated filter should live. For simple filters this is the "BasicFilters" directory.</p>
<h1><a class="anchor" id="FileStructure"></a>
JSON File Structure</h1>
<p>JSON (JavaScript <a class="elRef" doxygen="/work/SimpleITK-build/SimpleITK-build/Documentation/Doxygen/InsightDoxygen.tag:https://www.itk.org/Doxygen/html//" href="https://www.itk.org/Doxygen/html/classitk_1_1Object.html">Object</a> Notation) is a simple text formatting system used to specify data values. A full description of the specification can be found at <a href="http://www.json.org/">http://www.json.org/</a>. For the purposes of SimpleITK, a json file consists of a single data object (denoted by {}) which contains several string : value pairs (here value may be a list denoted by []) and sub-objects. Here is an example from LaplacianRecursiveGaussian:</p>
<pre class="fragment">{
  "name" : "LaplacianRecursiveGaussianImageFilter",
  "template_code_filename" : "ImageFilter",
  "template_test_filename" : "ImageFilter",
  "doc" : "",
  "number_of_inputs" : 1,
  "pixel_types" : "BasicPixelIDTypeList",
  "output_pixel_type" : "float",
  "members" : [
    {
      "name" : "Sigma",
      "type" : "double",
      "default" : "1.0",
      "doc" : "",
      "briefdescriptionSet" : "",
      "detaileddescriptionSet" : "Set Sigma value. Sigma is measured in the units of image spacing.",
      "briefdescriptionGet" : "",
      "detaileddescriptionGet" : "Set Sigma value. Sigma is measured in the units of image spacing."
    },
    {
      "name" : "NormalizeAcrossScale",
      "type" : "bool",
      "default" : "false",
      "doc" : "",
      "briefdescriptionSet" : "",
      "detaileddescriptionSet" : "Define which normalization factor will be used for the Gaussian \\see RecursiveGaussianImageFilter::SetNormalizeAcrossScale",
      "briefdescriptionGet" : "",
      "detaileddescriptionGet" : "Define which normalization factor will be used for the Gaussian \\see RecursiveGaussianImageFilter::SetNormalizeAcrossScale"
    }
  ],
  "tests" : [
    {
      "tag" : "default",
      "description" : "Simply run with default settings",
      "settings" : [],
      "tolerance" : 0.0001,
      "inputs" : [
        "Input/RA-Float.nrrd"
      ]
    }
  ],
  "briefdescription" : "Computes the Laplacian of Gaussian (LoG) of an image.",
  "detaileddescription" : "Computes the Laplacian of Gaussian (LoG) of an image by convolution with the second derivative of a Gaussian. This filter is implemented using the recursive gaussian filters.",
  "itk_module" : "ITKImageFeature",
  "itk_group" : "ImageFeature"
}
</pre><p>In this example, we see that all pairs must use a string as the key, but may have any valid type as the value (string - "Abs", number - 1, list - [], object - {}).</p>
<h1><a class="anchor" id="GlobalFields"></a>
Fields For All Templates</h1>
<p>This section describes the minimal set of fields required to wrap an ITK filter into SimpleITK.</p>
<h2><a class="anchor" id="TopLevelFields"></a>
Top Level Fields</h2>
<ul>
<li><b>name:</b> (<em>string</em>) This must be the name of the ITK filter.</li>
<li><b>templage_code_filename:</b> (<em>string</em>) Which of the template files should be used to generate the filter. Choices are: "ImageFilter", "RegionGrowingImageFilter", "StructuringElementImageFilter", "LevelSetImageFilter", "MathematicalMorphologyImageFilter"</li>
<li><b>template_test_filename:</b> (<em>string</em>) Which of the template files should be used to generate the test for this filter. Choices are: "ImageFilter", "RegionGrowingImageFilter"</li>
<li><b>number_of_inputs:</b> (<em>integer</em>) How many input images are used for this filter. Currently, the template system only supports filters with 1 or 2 input images</li>
<li><b>briefdescription:</b> (<em>string</em>) Brief description of the class (Doxygen format). This string is automatically generated by the Utilities/BuildDocs and Utilities/GenerateDocumentation.groovy scripts. If no corresponding ITK class exists, this field will not be modified. This field is maintained with the JSONDocUpdate.sh script.</li>
<li><b>detaileddescription:</b> (<em>string</em>) More detailed description of the class (Doxygen format). This string is automatically generated by the Utilities/BuildDocs and Utilities/GenerateDocumentation.groovy scripts. If no corresponding ITK class exists, this field will not be modified. This field is maintained with the JSONDocUpdate.sh script.</li>
<li><b>pixel_types:</b> (<em>string</em>) Which of the pixel type lists should be supported for this filter. The type lists are defined in <a class="el" href="sitkPixelIDTypeLists_8h.html">sitkPixelIDTypeLists.h</a></li>
<li><b>members:</b> (<em>list</em>) This list specifies all member variables that should be accessible to the user with a Get/Set mechanism and should be part of the Execute signature for the filter. Each entry in the list must be an object</li>
<li><b>tests:</b> (<em>list</em>) This list specifies all automatic tests that should be generated for the filter. Each entry in the list must be an object. If no tests are specified, a test will be generated that fails with the message that a test must be written for the filter</li>
<li><b>itk_module:</b> (<em>string</em>) A string naming the ITK module the filter originates from. If the ITK installation used for building SimpleITK does not have this named module then the filter will be omitted in SimpleITK. This filed is maintained JSONUpdateITKModules.py script.</li>
<li><b>itk_group:</b> (<em>string</em>) A string naming the ITK group the ITK filter originates.</li>
<li>[OPTIONAL] <b>include_files:</b> (<em>list</em>) This list of strings specifies additional header files to include in the cxx file for this filter.</li>
<li>[OPTIONAL] <b>custom_set_intput:</b> (<em>string</em>) Code which is used to set input or multiple inputs to the filter. This overrides the standard setting of the inputs.</li>
<li>[OPTIONAL] <b>output_pixel_type:</b> (<em>string</em>) String representing the specific pixel type to use for the output image of the filter.</li>
<li>[OPTIONAL] <b>filter_type:</b> (<em>string</em>) Explicitly sets the FilterType used. This method overides additional_template_types. Useful typedefs are InputImageType, and OutputImageType.</li>
<li>[OPTIONAL] <b>public_declarations:</b> (<em>string</em>) Any c++ code written in this field will be placed into the public section of the filter's header file</li>
<li>[OPTIONAL] <b>additional_template_types:</b> (<em>list</em>) The standard ITK image filter template signature is:</li>
</ul>
<pre class="fragment">&lt;InputImageType, (if 2 inputs)InputImageType, OutputImageType)&gt;
</pre><p>Some filters require additional template types between the list of input image types and the output image type such as the input type of a constant. This list allows these additional parameters to be added so that the template signature looks like:</p>
<pre class="fragment">&lt;InputImageType, (if 2 inputs)InputImageType, (ADDITIONAL TYPES), OutputImageType)&gt;
</pre><p>Each type in the list is specified by an object with a only a <b>type</b> field which is a string specifying the type to be used.</p>
<ul>
<li>[OPTIONAL] <b>custom_methods:</b> (<em>list</em>) This is a list of objects specifying custom methods that should be added to the filter. The fields required for a custom method are:<ul>
<li><b>doc:</b> (<em>string</em>) Documentation for this custom method</li>
<li><b>name:</b> (<em>string</em>) The name of the method</li>
<li><b>return_type:</b> (<em>string</em>) the return type of the method</li>
<li>[OPTIONAL] <b>parameters:</b> (<em>list</em>) A list of parameters for the method. Each method is specified by an object with the following fields:<ul>
<li><b>type:</b> (<em>string</em>) The parameter's type</li>
<li><b>var_name:</b> (<em>string</em>) The name of the variable to be used in the <b>body</b> field for the custom method</li>
</ul>
</li>
<li><b>body:</b> (<em>string</em>) This string is the body of the method and will be placed directly into the header file. The parameter names specified with <b>var_name</b> in each of the parameter obects can be used in this body</li>
</ul>
</li>
</ul>
<p>A sample custom method might look like:</p>
<pre class="fragment">{ "name" : "Foo",
  "doc" : "This method checks if a string is equal to Foo"
  "return_type" : "bool",
  "parameters" : [
    { "type" : "std::string",
      "var_name" : "inString"
    }
  ],
  "body" : "if (!strcmp(inString.c_str(), "Foo")) { return true; } else { return false; }"
}
</pre><p>This will translate to a custom method that looks like:</p>
<pre class="fragment">  /**
   * This method checks if a string is equal to Foo
   */
  bool Foo( std::string inString )
    {
    if (!strcmp(inString.c_str(), "Foo")) { return true; } else { return false; }
    }
</pre><h2><a class="anchor" id="MemberFileds"></a>
Member Fields</h2>
<p>A basic member object looks like:</p>
<pre class="fragment">{
  "name" : "Sigma",
  "type" : "double",
  "default" : 1.0,
  "briefdescriptionSet" : "",
  "detaileddescriptionSet" : "Define which normalization factor will be used for the Gaussian\\see RecursiveGaussianImageFilter::SetNormalizeAcrossScale\n\n",
  "briefdescriptionGet" : "",
  "detaileddescriptionGet" : ""
 }
</pre><ul>
<li><b>name:</b> (<em>string</em>) The name of the member variable. A variable named "Var" will be accessible with the methods "GetVar" and "SetVar"</li>
<li><b>type:</b> (<em>string</em>) The c++ type for this member. If using a type contained in a certain namespace (<a class="el" href="namespaceitk_1_1simple.html">itk::simple</a> for example), this must be included in the type description. If the member variable is of type bool, the additional ${name}On, and ${name}Off member functions are added.</li>
<li><b>default:</b> (<em>string</em> or <em>number</em>) The default value for this member. This can be a number for numerical types or a string specifying the constructor for non-basic types (std::vector&lt; unsigned int &gt;() for example)</li>
<li><b>briefdescriptionSet/briefdescriptionGet</b>: (<em>string</em>) Brief Doxygen documentation for this individual parameter. The two forms (Set/Get) are used for the SetMember and GetMember functions. This field is automatically generated from ITK's Doxgen for members that mirror ITK's members. If the member if a custom, this field will not be modified.</li>
<li><b>detaileddescriptionSet/detaileddescriptionGet</b>: (<em>string</em>) Detailed Doxygen documentation for this individual parameter. The two forms (Set/Get) are used for the SetMember and GetMember functions. This field is automatically generated from ITK's Doxgen for members that mirror ITK's members. If the member if a custom, this field will not be modified.</li>
<li>[OPTIONAL] <b>no_set_method:</b> (0 or 1) If set to 1, the filter will not have a Set method for this member</li>
<li>[OPTIONAL] <b>no_get_method:</b> (0 or 1) If set to 1, the filter will not have a Get method for this member</li>
<li>[OPTIONAL] <b>no_print:</b> (0 or 1) If set to 1, this member will not be printed in the ToString method</li>
<li>[OPTIONAL] <b>dim_vec:</b> (0 or 1) If set to 1, this indicates that the member is a std::vector with size equal to the dimension of the input image. As such, it will be printed out correctly and cast to its corresponding ITK type correctly</li>
<li>[OPTIONAL] <b>set_as_scalar:</b> (0 or 1) If parameter is a dim_vec, then this method adds an additional set member method to set the variable as a scalar so that all components are the same</li>
<li>[OPTIONAL] <b>enum:</b> [ "enum1", "enum2", ... ] Creates a member type of the class with the array of strings with a type defined by the name of this parameter. This field makes the "type" parameter optional. It is recommended to add a test to ensure the SimpleITK values correspond to the ITK values.</li>
<li>[OPTIONAL] <b>custom_itk_cast:</b> (<em>string</em>) Some non-basic types will require a custom cast before the corresponding ITK filter's member can be set. This field allows the developer to specify exactly how the ITK filter sets the member's value from the SimpleITK member's value for example:</li>
</ul>
<pre class="fragment">"custom_itk_cast" :
  "filter-&gt;SetObjectValue(static_cast&lt;typename FilterType::PixelType&gt;(this-&gt;GetObjectValue()) );"
</pre><h2><a class="anchor" id="TestFields"></a>
Test Fields</h2>
<p>A basic test object looks like:</p>
<pre class="fragment">{
  "tag" : "float",
  "description" : "Dilate a float image",
  "inputA" : "Input/RA-Slice-Float.nrrd",
  "tolerance" : 0.01,
  "settings" : []
}
</pre><p>There are three ways of checking the resulting image: against a baseline image, a sha1 hash, or an md5 hash. At least one of these options must be used for each test.</p>
<ul>
<li><b>tag:</b> (<em>string</em>) The tag to identify this specific test for the filter</li>
<li><b>descriptoin:</b> (<em>string</em>) Documentation to describe this specific test</li>
<li><b>inputA:</b> (<em>string</em>) The path from the SOURCE_DIR/Testing/Data directory for the (first) input image</li>
<li><b>inputA_cast:</b> (<em>string</em>) an sitkPixelIDEnum, after inputA is read the <a class="el" href="classitk_1_1simple_1_1CastImageFilter.html" title="A hybrid cast image filter to convert images to other types of images. ">CastImageFilter</a> is run, to covert the image type.</li>
<li>[OPTIONAL] <b>inputB:</b> (<em>string</em>) If <b>number_of_inputs</b> is 2, this specifies the path from SOURCE_DIR/Testing/Data to the second input image</li>
<li>[OPTIONAL] <b>tolerance:</b> (<em>float</em>) An error tolerance fo be used when comparing the resulting image to the baseline. This is used to specify that the result should be checked against a baseline image</li>
<li>[OPTIONAL] <b>md5hash:</b> (<em>string</em>) An md5 hash value to compare the resulting image against.</li>
<li>[OPTIONAL] <b>sha1hash:</b> (<em>string</em>) A sha1 hash value to compare the resulting image against.</li>
<li>[OPTIONAL] <b>settings:</b> (<em>list</em>) A list of any specific parameters values for this test. Each entry is an object of the form:</li>
</ul>
<pre class="fragment">{ "parameter" : "Sigma",
  "value" : 1.0
}
</pre><ul>
<li><b>Settings</b> <b>Options:</b> <ul>
<li><b>parameter:</b> (<em>string</em>) The name of the parameter. This must match the name used when creating the filter</li>
<li><b>value:</b> (<em>string</em> or <em>number</em>) The value to assign to the parameter. This can be a number for numerical types or a string representing the constructor for more complex types</li>
<li>[OPTIONAL] <b>python_value:</b> (<em>string</em>) For types that require a different syntax for setting the value in python, this will override the string in <b>value</b> </li>
<li>[OPTIONAL] <b>lua_value:</b> (<em>string</em>) For types that require a different syntax for setting the value in lua, this will override the string in <b>value</b> </li>
<li>[OPTIONAL] <b>ruby_value:</b> (<em>string</em>) For types that require a different syntax for setting the value in ruby, this will override the string in <b>value</b> </li>
<li>[OPTIONAL] <b>java_value:</b> (<em>string</em>) For types that require a different syntax for setting the value in java, this will override the string in <b>value</b> </li>
<li>[OPTIONAL] <b>tcl_value:</b> (<em>string</em>) For types that require a different syntax for setting the value in tcl, this will override the string in <b>value</b> </li>
<li>[OPTIONAL] <b>R_value:</b> (<em>string</em>) For types that require a different syntax for setting the value in R, this will override the string in <b>value</b> </li>
<li>[OPTIONAL] <b>dim_vec:</b> (0 or 1): Use this flag if this parameter is a std::vector. If set to 1, the <b>type</b> option must also be set</li>
<li>[OPTIONAL] <b>no_get_method:</b> (0 or 1). Set to 1 when the filter does not have a get method, so that this method will not be tested.</li>
<li>[OPTIONAL] <b>type:</b> (<em>string</em>): What type the vector should be. Due to constraints with java, this should only be a primitive type. For unsigned types, the java test will convert to the signed equivalent. An example for a dim_vec parameter is:</li>
</ul>
</li>
</ul>
<pre class="fragment">{ "parameter" : "Size",
  "dim_vec" : 1,
  "type" : "unsigned int"
  "value" : "{1,2}",
  "java_value" : "{1,2}",
  "tcl_value" : "[list 1 2]",
  "python_value" : "[1,2]",
  "lua_value" : "{1,2}",
  "ruby_value" : "[1,2]"
}
</pre><h1><a class="anchor" id="Structure"></a>
Directory Structure</h1>
<p>The code generation system is designed to be agnostic of what subdirectory is being parsed. An example of this is BasicFilters. Here will just refer to $FILTER_DIR</p>
<p>There are four important subdirectores in $SimpleITK_SOURCE_DIR/Code/$FILTER_DIR:</p>
<ul>
<li><b>include:</b> Manually written header files</li>
<li><b>src:</b> Manually written c++ files</li>
<li><b>json:</b> The input json files used to generate new filters at build time</li>
<li><b>templates:</b> The code templates that can be used to generate filters for this directory</li>
</ul>
<p>When a filter is generated, it produces a .h and a .cxx file that are placed in $SimpleITK_BUILD_DIR/Code/$FILTER_DIR/include and $SimpleITK_BUILD_DIR/Code/$FILTER_DIR/src respectively.</p>
<p>It is also worth noting that the template files in the <b>templates</b> directory are comprised of a combination of c++ code, lua template expansion directives, and $(include xxx) statements. These include statements each pull in a section of template code from a file in $SimpleITK_SOURCE_DIR/ExpandTemplateGenerator/Components. These component files represent pieces of templates that are shared by multiple unique filter template types.</p>
<h1><a class="anchor" id="Templates"></a>
Specialized Templates</h1>
<p>The standard template is <a class="el" href="classitk_1_1simple_1_1ImageFilter.html" title="The base interface for SimpleITK filters that take one input image. ">ImageFilter</a>. This section describes the differences for each of the other template types.</p>
<ul>
<li><b><a class="elRef" doxygen="/work/SimpleITK-build/SimpleITK-build/Documentation/Doxygen/InsightDoxygen.tag:https://www.itk.org/Doxygen/html//" href="https://www.itk.org/Doxygen/html/classitk_1_1Region.html">Region</a> Growing <a class="el" href="classitk_1_1simple_1_1Image.html" title="The Image class for SimpleITK. ">Image</a> Filters:</b> The region growing filters support an additional set of methods for manipulating the seed list. Each region growing filter has the SetSeed, AddSeed, and ClearSeeds methods. See <a class="el" href="sitkConnectedThresholdImageFilter_8h.html">sitkConnectedThresholdImageFilter.h</a> for details.</li>
<li><b>Kernel <a class="el" href="classitk_1_1simple_1_1Image.html" title="The Image class for SimpleITK. ">Image</a> Filters:</b> The kernel image filters use a KernelType and have an external enum which allows the user to select which kernel to use. See <a class="el" href="sitkErodeObjectMorphologyImageFilter_8h.html">sitkErodeObjectMorphologyImageFilter.h</a> for details.</li>
<li><b> Dual <a class="el" href="classitk_1_1simple_1_1Image.html" title="The Image class for SimpleITK. ">Image</a> Filter:</b> The dual image filter template's usage should be avoided because it instantiates the combination of two pixel type lists. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 16 2020 20:47:12 for SimpleITK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
